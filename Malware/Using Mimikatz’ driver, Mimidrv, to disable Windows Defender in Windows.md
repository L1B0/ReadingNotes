# Using Mimikatz’driver, Mimidrv, to disable Windows Defender in Windows(2020)

## What's Mimikatz

Mmkz是一个开源的利用工具，用于收集Windows系统的身份验证信息。

它利用Windows在内存中存储信息的方式中的漏洞，可以收集散列、纯文本密码、Kerberos(票据授予)票据和智能卡身份验证中使用的PIN码。

但是许多功能需要运行在**管理员权限**。

### Mimikatz Driver

MD是一个经过签名的驱动，于是可以被win10加载。

通过IOCTL消息，可以实现在Ring3与驱动通信，对内存的读写。

### 反病毒工具

Windows是台式机和笔记本电脑上使用最多的操作系统，全球使用率超过77%。

在我们的测试中，我们重点关注Windows Defender，因为它是Windows上使用最多的反病毒解决方案，采用率超过50%。［13］

av通常通过mini-filter实现对文件系统数据的监控和追踪。

### mini-filter

每个文件首先通过这样一个迷你过滤器。然后，根据发生的事件，迷你过滤器开始执行应该执行的回调例程列表。

例如，当一个事件发生时，比如创建一个新进程，它将遍历一个指向在创建这个新进程之前应该执行的方法的指针列表。

取消反病毒回调意味着阻止我们感兴趣的方法执行，并有严重的后果。反病毒程序将不再检查和过滤文件，因此没有问题或病毒将被发现。

这是因为**执行检查的回调函数不再执行。**在这个研究过程中，我们将禁用整个Windows卫士进程以及取消某些回调。

取消挂钩回调的额外好处是，与禁用进程相比，它不那么明显。它减少了杀毒程序或操作系统通知用户的可能性，有些东西是错误的。

### 内核补丁保护

现代版本的Windows可以防止依赖于未经授权修改内核空间的攻击。这种保护被称为内核补丁保护(KPP)，也被称为PatchGuard。

KPP的设计是为了防止未经授权的内存空间改变。这意味着设备驱动程序不允许改变内核内存中的核心系统结构。

然而，KPP已知有一些弱点。为了确保KPP在我们的研究过程中不会成为一个因素，我们决定在我们的设置中完全禁用KPP

### 相关工作

M.  Lavrijsen创建了一个工具，PPLKiller，它可以删除PPL。他使用自己的驱动程序来做这件事，这将删除所有运行进程的进程保护。但是，这个驱动程序没有签名，在运行此工具时需要启用一个名为testsigning的BCDEdit特性。我们的目标是展示如何通过Mimidrv实现这一点，而不需要进行测试签名，并记录它是如何工作的

