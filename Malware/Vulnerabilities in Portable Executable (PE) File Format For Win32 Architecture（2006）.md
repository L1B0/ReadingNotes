# Vulnerabilities in Portable Executable (PE) File Format For Win32 Architecture（2006）

## Intro

![image-20211207195756647](http://gavinl1b0223342.oss-cn-beijing.aliyuncs.com/img/image-20211207195756647.png)

## Section Header

### 成员解释

`winnt.h`的结构体`IMAGE_SECTION_HEADER`定义了每个section的内容，成员VirtualSize, VirtualAddress,  PointerToRawData  and  SizeOfRawData重点介绍，同时使用struct _IMAGE_OPTIONAL_HEADER中的FileAlignment和SectionAlignment来说明这一点:

- VirtualSize
- VirtualAddress: RVA, 相对虚拟地址
  - VirtualAddress = VirtualAddress & ~(SectionAlignment – 1)
- PointerToRawData：文件偏移部分
  - PointerToRawData = PointerToRawData & ~ (FileAlignment – 1)
- SizeOfRawData
- FileAlignment：要么是0x200 or 0x1000，并且<=SectionAlignment，页大小（4KB）

### Section之间的空闲虚拟空间

SizeOfRawData与VirtualSize的关系：

- 若S<V, V和S之间的空间在RAM中被填充0；
- 若S>V, 则用于其他内容，比如不增加文件大小的嵌入式代码；